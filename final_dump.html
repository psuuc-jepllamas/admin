<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Materials and Questions Data</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <!-- Navigation -->
    <div id="container">
        <div class="top-right-image">
            <img src="assets/imgs/design.png" alt="Design Image" width="200">
        </div>
        <div class="top-right-admin-profile">
            <ion-icon class="me-1" name="person"></ion-icon><span class="text-light fw-bold">Admin</span>
        </div>

        <div class="navigation">
            <ul>
                <li><a href=""><span class="title fw-bold mt-3" style="font-size: 24px;">GestoCom</span></a></li>
                <li><a href="dashboard.html"><span class="title fw-bold">Dashboard</span></a></li>
                <li><a href="educational_materials.html"><span class="title fw-bold">Educational Materials</span></a></li>
                <li><a href="feedbacks.html"><span class="title fw-bold">Feedbacks</span></a></li>
                <li><a href="accountmanage.html"><span class="title fw-bold">Account Management</span></a></li>
            </ul>
        </div>
    </div>

    <!-- Main content -->
    <div class="main-content">
        <h2 class="mt-5 mb-3 fw-semibold">Educational Materials</h2>
        <button class="btn btn-primary me-5" data-bs-toggle="modal" data-bs-target="#createMaterialModal">+ Create New</button>

        <!-- beginner modules -->
        <div class="mt-3 p-4 bm-5 shadow">
            <table>
                <thead>
                    <tr>
                        <th class="fw-semibold" scope="col">Category Title</th>
                        <th class="fw-semibold" scope="col">Expertise Level</th>
                        <th class="fw-semibold" scope="col">Video</th>
                        <th class="fw-semibold" scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="data-table">
                    <!-- beginner modules data -->
                </tbody>
            </table>
        </div>

        <!-- question -->
        <h2 class="mt-5 mb-3 fw-semibold">Questions Data</h2>
        <button class="btn btn-primary me-5" data-bs-toggle="modal" data-bs-target="#createQuestionModal">+ Add Questions</button>
        <div class="mt-3 p-4 bm-5 shadow">
            <table>
                <thead>
                    <tr>
                        <th class="fw-semibold">Question ID</th>
                        <th class="fw-semibold">Options</th>
                        <th class="fw-semibold">Answer</th>
                        <th class="fw-semibold">Actions</th>
                    </tr>
                </thead>
                <tbody id="questions-table">
                    <!-- question data -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- material modal -->
    <div class="modal fade" id="createMaterialModal" tabindex="-1" aria-labelledby="createMaterialModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createMaterialModalLabel">Create New Educational Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createMaterialForm">
                        <div class="mb-3">
                            <label for="materialTitle" class="form-label">Category Title</label>
                            <input type="text" class="form-control" id="materialTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="expertise_level" class="form-label">Expertise Level</label>
                            <input type="text" class="form-control" id="expertise_level" required>
                        </div>
                        <div class="mb-3">
                            <label for="videoUrl" class="form-label">Video URL</label>
                            <input type="url" class="form-control" id="videoUrl" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitMaterialForm()">Create</button>
                </div>
            </div>
        </div>
    </div>

    <!-- question modal -->
    <div class="modal fade" id="createQuestionModal" tabindex="-1" aria-labelledby="createQuestionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createQuestionModalLabel">Add New Question</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createQuestionForm">
                        <div class="mb-3">
                            <label for="questionOptionA" class="form-label">Option A</label>
                            <input type="text" class="form-control" id="questionOptionA" required>
                        </div>
                        <div class="mb-3">
                            <label for="questionOptionB" class="form-label">Option B</label>
                            <input type="text" class="form-control" id="questionOptionB" required>
                        </div>
                        <div class="mb-3">
                            <label for="questionOptionC" class="form-label">Option C</label>
                            <input type="text" class="form-control" id="questionOptionC" required>
                        </div>
                        <div class="mb-3">
                            <label for="questionOptionD" class="form-label">Option D</label>
                            <input type="text" class="form-control" id="questionOptionD" required>
                        </div>
                        <div class="mb-3">
                            <label for="questionAnswer" class="form-label">Correct Answer</label>
                            <input type="text" class="form-control" id="questionAnswer" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitQuestionForm()">Add Question</button>
                </div>
            </div>
        </div>
    </div>

    <!-- update material -->
    <div class="modal fade" id="updateMaterialModal" tabindex="-1" aria-labelledby="updateMaterialModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateMaterialModalLabel">Update Educational Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="updateMaterialForm">
                        <input type="hidden" id="updateMaterialId">
                        <div class="mb-3">
                            <label for="updateMaterialTitle" class="form-label">Category Title</label>
                            <input type="text" class="form-control" id="updateMaterialTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="updateExpertiseLevel" class="form-label">Expertise Level</label>
                            <input type="text" class="form-control" id="updateExpertiseLevel" required>
                        </div>
                        <div class="mb-3">
                            <label for="updateVideoUrl" class="form-label">Video URL</label>
                            <input type="url" class="form-control" id="updateVideoUrl" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitUpdateMaterialForm()">Update</button>
                </div>
            </div>
        </div>
    </div>

    <!-- delete material -->
    <div class="modal fade" id="deleteMaterialModal" tabindex="-1" aria-labelledby="deleteMaterialModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteMaterialModalLabel">Delete Educational Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this material?</p>
                    <input type="hidden" id="deleteMaterialId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="deleteMaterial()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- update question -->
    <div class="modal fade" id="updateQuestionModal" tabindex="-1" aria-labelledby="updateQuestionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateQuestionModalLabel">Update Question</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="updateQuestionForm">
                        <input type="hidden" id="updateQuestionId">
                        <div class="mb-3">
                            <label for="updateQuestionOptionA" class="form-label">Option A</label>
                            <input type="text" class="form-control" id="updateQuestionOptionA" required>
                        </div>
                        <div class="mb-3">
                            <label for="updateQuestionOptionB" class="form-label">Option B</label>
                            <input type="text" class="form-control" id="updateQuestionOptionB" required>
                        </div>
                        <div class="mb-3">
                            <label for="updateQuestionOptionC" class="form-label">Option C</label>
                            <input type="text" class="form-control" id="updateQuestionOptionC" required>
                        </div>
                        <div class="mb-3">
                            <label for="updateQuestionOptionD" class="form-label">Option D</label>
                            <input type="text" class="form-control" id="updateQuestionOptionD" required>
                        </div>
                        <div class="mb-3">
                            <label for="updateQuestionAnswer" class="form-label">Correct Answer</label>
                            <input type="text" class="form-control" id="updateQuestionAnswer" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitUpdateQuestionForm()">Update</button>
                </div>
            </div>
        </div>
    </div>

    <!-- delete question -->
    <div class="modal fade" id="deleteQuestionModal" tabindex="-1" aria-labelledby="deleteQuestionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteQuestionModalLabel">Delete Question</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this question?</p>
                    <input type="hidden" id="deleteQuestionId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="deleteQuestion()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-LB8PHM7kBQUC4LJ/5f72fM5tc5m93owhMGR1vWX11P8p1goZsfvktbEmhOGiH7uB"
        crossorigin="anonymous"></script>
    <script src="assets/js/script.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import {
            getFirestore, doc, getDoc, collection, getDocs,
            addDoc, updateDoc, deleteDoc
        } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDGaL4b1BEFuC_j4GLgmkO9qmJGjQFp23w",
            authDomain: "capstone-102.firebaseapp.com",
            projectId: "capstone-102",
            storageBucket: "capstone-102.appspot.com",
            messagingSenderId: "210094060867",
            appId: "1:210094060867:web:4856129ff4008708ebebf6",
            measurementId: "G-M3KYDWRN84"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

// create educ material
        async function submitMaterialForm() {
            const categoryTitle = document.getElementById('materialTitle').value;
            const expertise_level = document.getElementById('expertise_level').value;
            const videoUrl = document.getElementById('videoUrl').value;

            if (categoryTitle && expertise_level && videoUrl) {
                try {
                    await addDoc(collection(db, "Categories/beginner/modules"), {
                        title: categoryTitle,
                        expertiseLevel: expertise_level,
                        video_url: videoUrl
                    });
                    alert("Material added successfully!");
                    location.reload();
                } catch (error) {
                    console.error("Error adding document: ", error);
                }
            }
        }

        // Create Question
        async function submitQuestionForm() {
            const optionA = document.getElementById('questionOptionA').value;
            const optionB = document.getElementById('questionOptionB').value;
            const optionC = document.getElementById('questionOptionC').value;
            const optionD = document.getElementById('questionOptionD').value;
            const answer = document.getElementById('questionAnswer').value;

            if (optionA && optionB && optionC && optionD && answer) {
                try {
                    await addDoc(collection(db, "Questions/Beginner/Question"), {
                        a: optionA,
                        b: optionB,
                        c: optionC,
                        d: optionD,
                        answer: answer
                    });
                    alert("Question added successfully!");
                    location.reload();
                } catch (error) {
                    console.error("Error adding document: ", error);
                }
            }
        }

// Fetch educational materials (Beginner modules)
async function fetchEducationalMaterials() {
    try {
        // Fetch category title
        const categoryRef = doc(db, 'Categories/beginner');
        const categoryDoc = await getDoc(categoryRef);
        const categoryData = categoryDoc.data();
        const categoryTitle = categoryData.title; // Assuming there's a title field in the beginner category

        // Fetch modules
        const modulesRef = collection(db, 'Categories/beginner/modules');
        const moduleSnapshot = await getDocs(modulesRef);
        const tableBody = document.getElementById('data-table');

        tableBody.innerHTML = ""; // Clear existing data

        moduleSnapshot.forEach((doc) => {
            const data = doc.data();
            const row = `
                <tr>
                    <td class="fw-semibold">${categoryTitle}</td> <!-- Using the fetched category title -->
                    <td class="fw-semibold">${data.expertiseLevel}</td> <!-- Ensure you fetch expertiseLevel correctly -->
                    <td class="fw-semibold text-decoration-none">
                        <a href="${data.video_url}" target="_blank">Watch Video</a>
                    </td>
                    <td class="fw-semibold">
                        <button class="btn btn-danger" onclick="deleteMaterial('${doc.id}')"><ion-icon name="trash-outline"></ion-icon></button>
                        <button class="btn btn-success" onclick="openUpdateMaterialModal('${doc.id}', '${data.title}', '${data.expertiseLevel}', '${data.video_url}')"><ion-icon name="pencil-outline"></ion-icon></button>
                    </td>
                </tr>`;
            tableBody.innerHTML += row;
        });
    } catch (error) {
        console.error("Error fetching educational materials: ", error);
    }
}
        // Fetch questions data
        async function fetchQuestionsData() {
            try {
                const questionRef = collection(db, 'Questions/Beginner/Question');
                const questionSnapshot = await getDocs(questionRef);
                const tableBody = document.getElementById('questions-table');

                tableBody.innerHTML = ""; // Clear existing data

                questionSnapshot.forEach((doc) => {
                    const data = doc.data();
                    const row = `
                        <tr>
                            <td class="fw-semibold">${doc.id}</td>
                            <td class="fw-semibold">A: ${data.a}, B: ${data.b}, C: ${data.c}, D: ${data.d}</td>
                            <td class="fw-semibold">${data.answer}</td>
                            <td class="fw-semibold">
                                <button class="btn btn-danger" onclick="deleteQuestion('${doc.id}')"><ion-icon name="trash-outline"></ion-icon></button>
                                <button class="btn btn-success" onclick="openUpdateQuestionModal('${doc.id}', '${data.a}', '${data.b}', '${data.c}', '${data.d}', '${data.answer}')">Update</button>
                            </td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            } catch (error) {
                console.error("Error fetching questions: ", error);
            }
        }

// Example educational materials data
let materials = [];
let questions = [];

// Function to render educational materials
function renderMaterials() {
    const tableBody = document.getElementById('data-table');
    tableBody.innerHTML = ''; // Clear existing data

    materials.forEach((material, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${material.title}</td>
            <td>${material.expertise_level}</td>
            <td><a href="${material.videoUrl}" target="_blank">View Video</a></td>
            <td>
                <button class="btn btn-warning" onclick="openUpdateMaterialModal(${index})">Update</button>
                <button class="btn btn-danger" onclick="openDeleteMaterialModal(${index})">Delete</button>
            </td>
        `;
        tableBody.appendChild(row);
    });
}

// Function to render questions
function renderQuestions() {
    const questionsTableBody = document.getElementById('questions-table');
    questionsTableBody.innerHTML = ''; // Clear existing data

    questions.forEach((question, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${index + 1}</td>
            <td>${question.options.join(', ')}</td>
            <td>${question.answer}</td>
            <td>
                <button class="btn btn-warning" onclick="openUpdateQuestionModal(${index})">Update</button>
                <button class="btn btn-danger" onclick="openDeleteQuestionModal(${index})">Delete</button>
            </td>
        `;
        questionsTableBody.appendChild(row);
    });
}

// Submit new material form
function submitMaterialForm() {
    const title = document.getElementById('materialTitle').value;
    const expertiseLevel = document.getElementById('expertise_level').value;
    const videoUrl = document.getElementById('videoUrl').value;

    materials.push({ title, expertise_level: expertiseLevel, videoUrl });
    renderMaterials();
    document.getElementById('createMaterialForm').reset();
    $('#createMaterialModal').modal('hide');
}

// Submit updated material form
function submitUpdateMaterialForm() {
    const index = document.getElementById('updateMaterialId').value;
    const title = document.getElementById('updateMaterialTitle').value;
    const expertiseLevel = document.getElementById('updateExpertiseLevel').value;
    const videoUrl = document.getElementById('updateVideoUrl').value;

    materials[index] = { title, expertise_level: expertiseLevel, videoUrl };
    renderMaterials();
    $('#updateMaterialModal').modal('hide');
}

// Open update material modal
function openUpdateMaterialModal(index) {
    const material = materials[index];
    document.getElementById('updateMaterialId').value = index;
    document.getElementById('updateMaterialTitle').value = material.title;
    document.getElementById('updateExpertiseLevel').value = material.expertise_level;
    document.getElementById('updateVideoUrl').value = material.videoUrl;
    $('#updateMaterialModal').modal('show');
}

// Open delete material modal
function openDeleteMaterialModal(index) {
    document.getElementById('deleteMaterialId').value = index;
    $('#deleteMaterialModal').modal('show');
}

// Delete material
function deleteMaterial() {
    const index = document.getElementById('deleteMaterialId').value;
    materials.splice(index, 1);
    renderMaterials();
    $('#deleteMaterialModal').modal('hide');
}

// Submit new question form
function submitQuestionForm() {
    const options = [
        document.getElementById('questionOptionA').value,
        document.getElementById('questionOptionB').value,
        document.getElementById('questionOptionC').value,
        document.getElementById('questionOptionD').value,
    ];
    const answer = document.getElementById('questionAnswer').value;

    questions.push({ options, answer });
    renderQuestions();
    document.getElementById('createQuestionForm').reset();
    $('#createQuestionModal').modal('hide');
}

// Submit updated question form
function submitUpdateQuestionForm() {
    const index = document.getElementById('updateQuestionId').value;
    const options = [
        document.getElementById('updateQuestionOptionA').value,
        document.getElementById('updateQuestionOptionB').value,
        document.getElementById('updateQuestionOptionC').value,
        document.getElementById('updateQuestionOptionD').value,
    ];
    const answer = document.getElementById('updateQuestionAnswer').value;

    questions[index] = { options, answer };
    renderQuestions();
    $('#updateQuestionModal').modal('hide');
}

// Open update question modal
function openUpdateQuestionModal(index) {
    const question = questions[index];
    document.getElementById('updateQuestionId').value = index;
    document.getElementById('updateQuestionOptionA').value = question.options[0];
    document.getElementById('updateQuestionOptionB').value = question.options[1];
    document.getElementById('updateQuestionOptionC').value = question.options[2];
    document.getElementById('updateQuestionOptionD').value = question.options[3];
    document.getElementById('updateQuestionAnswer').value = question.answer;
    $('#updateQuestionModal').modal('show');
}

// Open delete question modal
function openDeleteQuestionModal(index) {
    document.getElementById('deleteQuestionId').value = index;
    $('#deleteQuestionModal').modal('show');
}

// Delete question
function deleteQuestion() {
    const index = document.getElementById('deleteQuestionId').value;
    questions.splice(index, 1);
    renderQuestions();
    $('#deleteQuestionModal').modal('hide');
}

        // Call both fetch functions on page load
        window.onload = function () {
            fetchEducationalMaterials();
            fetchQuestionsData();
        };
    </script>
</body>

</html>
